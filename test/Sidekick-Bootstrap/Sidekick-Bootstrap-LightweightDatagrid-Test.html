<!DOCTYPE html>
<html>
  <head>
    <title>Lightweight Datagrid binding test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="./../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    
    <script src="./../../lib/require.js"></script>
	<script>
			requirejs.config({
			    baseUrl:	"../../",
			    paths: {
			        "jquery":				"lib/jquery-1.9.1",
			        "ko":					"lib/knockout-2.2.1.debug",
			        "lightweightDatagrid":	"src/Sidekick-Bootstrap/Sidekick-Bootstrap-LightweightDatagrid",
			        "pagination": 			"src/Sidekick-Bootstrap/Sidekick-Bootstrap-Pagination",
				    "orderController":		"src/Sidekick-Bootstrap/Sidekick-Bootstrap-OrderController",
				    "addClassMonad":		"src/common/AddClassLookupMonad"
			    }
			});
			require(["jquery", "ko", "lightweightDatagrid","pagination","orderController"], function($, ko, datagrid) {
			   $(document).ready (function () {
				  var  items = [
					        {name: "Alfa",age:26,course:"math",id:1},
					        {name: "Wolfram",age:24,course:"programing",id:2},
					        {name: "Beta",age:24,course:"gaming",id:3},
					        {name: "Zed",age:24,course:"graphics",id:4},
					        {name: "John",age:24,course:"literature",id:5},
					        {name: "Del",age:24,course:"modern arts",id:6},
					        {name: "Control",age:24,course:"arts",id:7},
					        {name: "Fred",age:22,course:"writing",id:8}];
					ko.applyBindings ({
						datagridVM: {
							
							dataSource:{
								read:function(itemPerPage,actualPage,callback,field,ascDesc){
									
									
									if (itemPerPage*actualPage>=items.length){
										actualPage=0;
									}
									
									if (ascDesc!=="none"){
										items.sort(function(a,b){
											if (ascDesc==="asc"){
												return a[field]>b[field];
											} else {
												return a[field]<b[field];
											}
										});	
									}
										
									if (itemPerPage!=="all"){
										var retItem=[];
										for (var i=0; i<itemPerPage; i=i+1){
											if (actualPage*itemPerPage+i<items.length){
												retItem.push(items[actualPage*itemPerPage+i]);	
											}
										}
										
									} else {
										var retItem=items;
									}
										
										
									callback(retItem);
									//alert("Ordering By: "+field+" Asc or Desc: "+ascDesc);
									
								},
								update: function(updatedItem){
									for (var i = 0 ; i < items.length; i+=1){
										if (items[i].id===updatedItem.id){
											items[i]=updatedItem;
										}
									}

								}
								
							},
							options:{
								pagination: {
									//actualPage: ko.observable(0),
									elementNumber: 8,
									//elementPerPage: ko.observable(2),
									selectorValue:ko.observable(2),								
									/*callback: function(i){
									
									},*/
									//size: "small",
									//align: "center",
									selector: [
									           {value: 1, label:"1"},
									           {value:2, label:"2"},
									           {value:4,label:"4"},
									           {value: "all" , label:"All"}]
									
								},
								header:[
									{label:"Full name", prop:"name", orderable:true,type:"text"},
									{label:"Course", prop:"course", orderable:true,type:"text"},
									{label:"Age", prop:"age", orderable:false,type:"number"}
									],
								updateButton:{
									label: "Update",
									icon: "icon-edit"
								}
								}
								
							}
					 
					});
				});
			});
	</script>
  </head>
  <body>
    <h1>Lightweight Datagrid binding test</h1>
    
    <div class="pull-right"> <select data-bind="options: datagridVM.options.pagination.selector, optionsText: 'label',optionsValue: 'value', value:  datagridVM.options.pagination.selectorValue"></select></div>
  	<div data-bind="lightweightDatagrid: datagridVM"></div>
  
	
  </body>
</html>